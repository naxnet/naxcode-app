DOCKER_COMMAND=docker
MKDIR_COMMAND=mkdir  -p
WGET_COMMAND=wget
UNZIP_COMMAND=unzip
CD_COMMAND=cd
RM_COMMAND=rm
BASH_COMMAND=/bin/bash
PYTHON_COMMAND=python3
PWD=$(shell pwd)



SRC_FOLDER=./src
DOCKER_SRC_FOLDER=/output

DOWNLOADER_FILENAME=download_file.sh
REVIEW_PROCESS_FILENAME=review_process.py
PUBLIC_ZIP_FILENAME=public.zip
PRIVATE_ZIP_FILENAME=private.zip
MAKEFILE_FILENAME=Makefile

DOWNLOADER_FILE_URL=https://gist.githubusercontent.com/so77id/fa4c5360d1efc9645d80a7ca8882e423/raw/6aeb005982867bf00068fcefdee713dcecf438aa/download_files.sh
REVIEW_PROCESS_URL=https://gist.githubusercontent.com/so77id/4f1aa1301811eef9705fd74be33c4b0f/raw/a8b06de7cc5e2896534da8dfa11a1a60b2003c3d/review_process.py

DOCKER_IMAGE=""
DOCKER_CONTAINER_NAME=""

RESPONSE_URL=
PUBLIC_ZIP_URL=
PRIVATE_ZIP_URL=
MAKEFILE_URL=
CODE_URLS=
CODE_NAMES=



DOCKER_RUN_COMMAND=$(DOCKER_COMMAND) run -it --rm -v $(PWD)/vendor:/$(SRC_FOLDER) --name=$(DOCKER_CONTAINER_NAME) $(DOCKER_IMAGE)

setup s:
	@$(MKDIR_COMMAND) $(DOCKER_SRC_FOLDER)
	@$(WGET_COMMAND) -O '$(DOCKER_SRC_FOLDER)/$(PUBLIC_ZIP_FILENAME)' '$(PUBLIC_ZIP_URL)'
	@$(UNZIP_COMMAND) '$(DOCKER_SRC_FOLDER)/$(PUBLIC_ZIP_FILENAME)' -d $(DOCKER_SRC_FOLDER)/public
	@$(RM_COMMAND) '$(DOCKER_SRC_FOLDER)/$(PUBLIC_ZIP_FILENAME)'
	#
	@$(WGET_COMMAND) -O '$(DOCKER_SRC_FOLDER)/$(PRIVATE_ZIP_FILENAME)' '$(PRIVATE_ZIP_URL)'
	@$(UNZIP_COMMAND) '$(DOCKER_SRC_FOLDER)/$(PRIVATE_ZIP_FILENAME)' -d $(DOCKER_SRC_FOLDER)/private
	@$(RM_COMMAND) '$(DOCKER_SRC_FOLDER)/$(PRIVATE_ZIP_FILENAME)'
	#
	@$(WGET_COMMAND) -O '$(DOCKER_SRC_FOLDER)/$(MAKEFILE_FILENAME)' '$(MAKEFILE_URL)'
	#
	@$(WGET_COMMAND) -O '$(DOCKER_SRC_FOLDER)/$(DOWNLOADER_FILENAME)' '$(DOWNLOADER_FILE_URL)'
	@$(BASH_COMMAND) $(DOCKER_SRC_FOLDER)/$(DOWNLOADER_FILENAME) '"$(CODE_URLS)"' '"$(CODE_NAMES)"' $(DOCKER_SRC_FOLDER)

	@$(WGET_COMMAND) -O '$(DOCKER_SRC_FOLDER)/$(REVIEW_PROCESS_FILENAME)' '$(REVIEW_PROCESS_URL)'
	$(CD_COMMAND) $(DOCKER_SRC_FOLDER) && $(PYTHON_COMMAND) '$(REVIEW_PROCESS_FILENAME)' '$(RESPONSE_URL)'

run r:
	$(DOCKER_RUN_COMMAND)  bash -c "cd $(SRC_FOLDER) && make setup CODE_NAMES='$(CODE_NAMES)' PUBLIC_ZIP_URL='$(PUBLIC_ZIP_URL)' PRIVATE_ZIP_URL='$(PRIVATE_ZIP_URL)' MAKEFILE_URL='$(MAKEFILE_URL)' CODE_URLS='$(CODE_URLS)' RESPONSE_URL='$(RESPONSE_URL)'";
	status=$$?
